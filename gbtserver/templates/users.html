{% extends "base.html" %} {% block body %}

<div class="max-w-sm w-full bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6">
  <div class="flex justify-between mb-3">
    <div class="flex justify-center items-center">
      <h5 class="text-xl font-bold leading-none text-gray-900 dark:text-white pe-1">GRADUBT Statistics</h5>
      <svg data-popover-target="chart-info" data-popover-placement="bottom" class="w-3.5 h-3.5 text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white cursor-pointer ms-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm0 16a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm1-5.034V12a1 1 0 0 1-2 0v-1.418a1 1 0 0 1 1.038-.999 1.436 1.436 0 0 0 1.488-1.441 1.501 1.501 0 1 0-3-.116.986.986 0 0 1-1.037.961 1 1 0 0 1-.96-1.037A3.5 3.5 0 1 1 11 11.466Z" />
      </svg>
      <div data-popover id="chart-info" role="tooltip" class="absolute z-10 invisible inline-block text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 w-72 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400">
        <div class="p-3 space-y-2">
          <h3 class="font-semibold text-gray-900 dark:text-white">Activity growth - Incremental</h3>
          <p>Report helps navigate cumulative growth of community activities. Ideally, the chart should have a growing trend, as stagnating chart signifies a significant decrease of community activity.</p>
          <h3 class="font-semibold text-gray-900 dark:text-white">Calculation</h3>
          <p>For each date bucket, the all-time volume of activities is calculated. This means that activities in period n contain all activities up to period n, plus the activities generated by your community in period.</p>
          <a href="#" class="flex items-center font-medium text-blue-600 dark:text-blue-500 dark:hover:text-blue-600 hover:text-blue-700 hover:underline"
            >Read more
            <svg class="w-2 h-2 ms-1.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4" /></svg
          ></a>
        </div>
        <div data-popper-arrow></div>
      </div>
    </div>
    <div></div>
  </div>

  <!-- Donut Chart -->
  <div class="py-6" id="donut-chart"></div>
</div>

<script>
  // ApexCharts options and config
  window.addEventListener("load", function () {
      const getChartOptions = (enggs, bbas, hums, ecos, laws) => {
          return {

              series: [enggs, bbas, hums, ecos, laws],
              colors: ["#1C64F2", "#16BDCA", "#FDBA8C", "#E74694", "#A3A0FB"],
              chart: {
                  height: 320,
                  width: "100%",
                  type: "donut",
              },
              stroke: {
                  colors: ["transparent"],
                  lineCap: "",
              },
              plotOptions: {
                  pie: {
                      donut: {
                          labels: {
                              show: true,
                              name: {
                                  show: true,
                                  fontFamily: "Inter, sans-serif",
                                  offsetY: 20,
                              },
                              total: {
                                  showAlways: true,
                                  show: true,
                                  label: "Registered Students",
                                  fontFamily: "Inter, sans-serif",
                                  formatter: function (w) {
                                      const sum = w.globals.seriesTotals.reduce((a, b) => {
                                          return a + b;
                                      }, 0);
                                      return `${sum}`;
                                  },
                              },
                              value: {
                                  show: true,
                                  fontFamily: "Inter, sans-serif",
                                  offsetY: -20,
                                  formatter: function (value) {
                                      return value + "";
                                  },
                              },
                          },
                          size: "80%",
                      },
                  },
              },
              grid: {
                  padding: {
                      top: -2,
                  },
              },
              labels: ["Engineering", "BBA", "Humanities", "Economics", "Law"],
              dataLabels: {
                  enabled: false,
              },
              legend: {
                  position: "bottom",
                  fontFamily: "Inter, sans-serif",
              },
              yaxis: {
                  labels: {
                      formatter: function (value) {
                          return value + "";
                      },
                  },
              },
              xaxis: {
                  labels: {
                      formatter: function (value) {
                          return value + "";
                      },
                  },
                  axisTicks: {
                      show: false,
                  },
                  axisBorder: {
                      show: false,
                  },
              },
          };
      };
      const enggs = {{ enggs|length }};
      const bbas = {{ bbas|length }};
      const hums = {{ hums|length }};
      const ecos = {{ ecos|length }};
      const laws = {{ laws|length }};


      if (document.getElementById("donut-chart") && typeof ApexCharts !== "undefined") {
          const chart = new ApexCharts(document.getElementById("donut-chart"), getChartOptions(enggs, bbas, hums,ecos,laws));
          chart.render();

          // Get all the checkboxes by their class name
          const checkboxes = document.querySelectorAll('#devices input[type="checkbox"]');

          // Function to handle the checkbox change event
          function handleCheckboxChange(event, chart) {
              const checkbox = event.target;
              if (checkbox.checked) {
                  switch (checkbox.value) {
                      case "desktop":
                      chart.updateSeries([15.1, 22.5, 4.4, 8.4]);
                      break;
                      case "tablet":
                      chart.updateSeries([25.1, 26.5, 1.4, 3.4]);
                      break;
                      case "mobile":
                      chart.updateSeries([45.1, 27.5, 8.4, 2.4]);
                      break;
                      default:
                      chart.updateSeries([55.1, 28.5, 1.4, 5.4]);
                  }
              } else {
                  chart.updateSeries([35.1, 23.5, 2.4, 5.4]);
              }
          }

          // Attach the event listener to each checkbox
          checkboxes.forEach((checkbox) => {
              checkbox.addEventListener("change", (event) => handleCheckboxChange(event, chart));
          });
      }
  });
</script>

<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
  <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
      <tr>
        <th scope="col" class="px-6 py-3"></th>
        <th scope="col" class="px-6 py-3">Name</th>
        <th scope="col" class="px-6 py-3">ID</th>
        <th scope="col" class="px-6 py-3">Department</th>
        <th scope="col" class="px-6 py-3">Intake</th>
        <th scope="col" class="px-6 py-3">Section</th>
        <th scope="col" class="px-6 py-3">Session</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr class="odd:bg-white odd:dark:bg-gray-900 even:bg-gray-50 even:dark:bg-gray-800 border-b dark:border-gray-700">
        <td class="px-6 py-4"><img src="{{user.dp.url}}" width="50px" height="50px" class="rounded-full object-full" /></td>
        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">{{ user.sname }}</th>
        <td class="px-6 py-4">{{user.sid}}</td>
        <td class="px-6 py-4">{{user.dept}}</td>
        <td class="px-6 py-4">{{user.intake}}</td>
        <td class="px-6 py-4">{{user.section}}</td>
        <td class="px-6 py-4">{{user.session}}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock body %}
